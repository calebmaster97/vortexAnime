<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HikariAnime</title>
<!-- Google Fonts for a clean look -->
<link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet" />
<style>
body {
  margin: 0; font-family: 'Inter', sans-serif; background-color: #1e1e2f; color: #eee;
}
header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 16px 20px; background-color: #2b2b3b;
}
header h1 {
  margin: 0; font-size: 1.8rem; color: #4fc3f7;
}
nav {
  display: flex; gap: 15px;
}
nav a {
  color: #ccc; text-decoration: none; font-weight: 500;
}
nav a:hover {
  color: #4fc3f7;
}
.filters {
  display: flex; flex-wrap: wrap; gap: 10px; padding: 10px 20px; background-color: #2b2b3b;
}
.filters select, .filters input {
  padding: 8px; border-radius: 4px; border: none; outline: none;
  font-size: 0.95rem;
}
#grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px; padding: 20px;
}
.card {
  background-color: #333; border-radius: 8px; overflow: hidden; transition: all 0.2s ease;
}
.card:hover { transform: translateY(-5px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
.card img {
  width: 100%; display: block;
}
.card div {
  padding: 8px; font-size: 0.9rem;
}
footer {
  text-align: center; padding: 16px; background-color: #2b2b3b; font-size: 0.8rem; color: #777;
}
#pagination {
  text-align: center; padding: 10px;
}
button {
  padding: 8px 16px; margin: 0 10px; border: none; border-radius: 4px; background-color: #4fc3f7; color: #222; cursor: pointer; font-weight: 600;
}
button:disabled { opacity: 0.5; cursor: not-allowed; }
</style>
</head>
<body>

<header>
  <h1>HikariAnime</h1>
  <nav>
    <a href="#">Home</a>
    <a href="#">Browse</a>
    <a href="#">My List</a>
  </nav>
</header>

<div class="filters">
  <select id="season">
    <option value="">All Seasons</option>
    <option value="WINTER">Winter</option>
    <option value="SPRING">Spring</option>
    <option value="SUMMER">Summer</option>
    <option value="FALL">Fall</option>
  </select>
  <select id="year"></select>
  <select id="sort">
    <option value="START_DATE_DESC">Newest</option>
    <option value="POPULARITY_DESC">Popularity</option>
    <option value="TITLE_ROMAJI">A-Z</option>
  </select>
  <input type="text" id="search" placeholder="Search..." />
  <button id="refresh">Refresh</button>
</div>

<div id="grid"></div>

<div id="pagination">
  <button id="prev">Previous</button>
  <span id="pageNum">Page 1</span>
  <button id="next">Next</button>
</div>

<footer>&copy; 2024 HikariAnime. Data from AniList.</footer>

<script>
const grid = document.getElementById('grid');
const yearSelect = document.getElementById('year');
const seasonSelect = document.getElementById('season');
const sortSelect = document.getElementById('sort');
const searchInput = document.getElementById('search');
const prevBtn = document.getElementById('prev');
const nextBtn = document.getElementById('next');
const pageSpan = document.getElementById('pageNum');

let currentPage = 1;
let totalPages = 1;

// Setup years dropdown (past 20 years)
function setupYears() {
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= currentYear - 20; y--) {
    const option = document.createElement('option');
    option.value = y;
    option.textContent = y;
    yearSelect.appendChild(option);
  }
}
setupYears();

async function fetchAnime(page=1) {
  grid.innerHTML = 'Loading...';
  const season = seasonSelect.value || null;
  const year = yearSelect.value ? parseInt(yearSelect.value) : null;
  const sort = sortSelect.value;
  const search = searchInput.value;

  const query = `
  query ($page: Int, $perPage: Int, $season: MediaSeason, $seasonYear: Int, $sort: [MediaSort], $search: String) {
    Page (page: $page, perPage: $perPage) {
      pageInfo { total pages currentPage }
      media (type: ANIME, season: $season, seasonYear: $seasonYear, search: $search, sort: $sort) {
        id
        title { romaji, english }
        coverImage { large }
        siteUrl
      }
    }
  }
  `;
  const variables = {
    page: page,
    perPage: 20,
    season: season,
    seasonYear: year,
    sort: [sort],
    search: search,
  };

  try {
    const res = await fetch('https://graphql.anilist.co', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, variables }),
    });
    const json = await res.json();
    const media = json.data.Page.media;
    const info = json.data.Page.pageInfo;
    totalPages = info.pages;
    currentPage = info.currentPage;
    pageSpan.textContent = `Page ${currentPage} / ${totalPages}`;
    prevBtn.disabled = currentPage <= 1;
    nextBtn.disabled = currentPage >= totalPages;
    render(media);
  } catch (err) {
    grid.innerHTML = 'Error loading data.';
    console.error(err);
  }
}

function render(media) {
  if (!media || media.length === 0) {
    grid.innerHTML = 'No results.';
    return;
  }
  grid.innerHTML = media.map(a => `
    <div class="card">
      <a href="${a.siteUrl}" target="_blank">
        <img src="${a.coverImage.large}" />
      </a>
      <div>${a.title.english || a.title.romaji}</div>
    </div>
  `).join('');
}

document.getElementById('prev').onclick = () => {
  if (currentPage > 1) {
    fetchAnime(currentPage - 1);
  }
};
document.getElementById('next').onclick = () => {
  if (currentPage < totalPages) {
    fetchAnime(currentPage + 1);
  }
};
document.getElementById('refresh').onclick = () => {
  fetchAnime(1);
};
searchInput.oninput = () => {
  fetchAnime(1);
};
seasonSelect.onchange = () => { fetchAnime(1); };
yearSelect.onchange = () => { fetchAnime(1); };
sortSelect.onchange = () => { fetchAnime(1); };

// Load initial data
fetchAnime();
</script>

</body>
</html>
